This directory contains some examples of all-atom simulations using the **AMBER** *(GAFF/GAFF2)* force field, prepared using moltemplate.

### Warning

As of 2022-8-16,
these examples are in a state of transition.  (See below.)  Use with caution.
There is no gaurantee that simulations prepared using moltemplate will exactly reproduce the behavior of AmberTools/AMBER.

If you notice a problem with these examples, please report it.
(jewett.aij @ gmail.com)


### Suggestion: Use AmberTools to generate correct @atom types

In each example, molecules (and molecular subunits) are stored in files
inside the "moltemplate_files/" subdirectory
*(such as: "benzene.lt", "ch2group.lt", "ch3group.lt")*.
Each atom inside these files is assigned to an @atom *type* which is
used to lookup force-field information.
Many of the examples are simple enough that it was easy
to manually guess the names of the correct @atom types needed for these
molecules by reading the atom type descriptions in the force field file:
(eg.
[gaff.lt](../../../moltemplate/force_fields/gaff.lt) or
[gaff2.lt](../../../moltemplate/force_fields/gaff2.lt)).
Guessing the @atom types manually (as I did) is unwise.
The accuracy of your simulation depends on using the correct @atom types.
Instead, I recommend using 3rd-party tools,
such as [AmberTools](https://ambermd.org/AmberTools.php).
AmberTools can create MOL2 files containing
the correct @atom types and charges for each molecule
(or molecular subunit) in your simulation.
Then you can convert each MOL2 file into moltemplate (LT) format using
[mol22lt.py program](../../../doc/doc_mol22lt.md#mol22ltpy).

*This is a better way to create these files
(eg. "benzene.lt", "ch2group.lt", "ch3group.lt").*
***(Note: These examples were created in 2014 before mol22lt.py was available.
When I have time I will update these examples using this strategy.
-Andrew 2022-8-16)***



### *The atomic charges in these examples are not correct*

Some force-fields (like COMPASS, and moltemplate's version of OPLSAA) include rules for assigning partial charges to atoms.  Most force fields, including AMBER GAFF and GAFF2 do not.  So GAFF and GAFF2 users will have to obtain atomic charges by some other means, probably by using 3rd-party tools.

*WARNING: (In many of these examples, I obtained partial charges from the OPLSAA
parameter file located [here](http://dasher.wustl.edu/tinker/distribution/params/oplsaa.prm).)*
***PLEASE DO NOT DO THIS!***
This is not how the AMBER force field was intended to be used.
It will probably not result in accurate behavior.
***When I have time I will update these examples to use the correct charges
obtained using AmberTools.  -Andrew 2022-8-16)***


#### It is the user's responsibility to calculate atomic charges correctly.

Charges are often stored in MOL2 files, which can be generated using

* [RED-server](https://upjv.q4md-forcefieldtools.org)
* [AmberTools](https://ambermd.org/AmberTools.php)
(using a
[variety of methods](http://ambermd.org/tutorials/basic/tutorial4b/index.htm))

Once generated, the information in the file (including the charges)
can be extracted using the
[mol22lt.py program](../../../doc/doc_mol22lt.md#mol22ltpy),
which is included with moltemplate.
***(WARNING: This program is experimental as of 2022-8-16.)***


Alternatively, you can try using the [OpenForceField tools](https://github.com/openmm/openmmforcefields#partial-charges-for-small-molecules) to [calculate these charges](https://open-forcefield-toolkit.readthedocs.io/en/latest/api/generated/openforcefield.topology.Molecule.html#openforcefield.topology.Molecule.compute_partial_charges_am1bcc).  The OpenForceField tools are not bundled with moltemplate.  If someone submits a script to help convert the files generated by these tools into moltemplate format, I would be happy post it and update these examples.  (-Andrew 2022-8-16)


### Requirements

The AMBER examples require a version of LAMMPS compiled with support for the optional "EXTRA-MOLECULE" package (because the AMBER force field currently uses *dihedral_style fourier*).  If you encounter the error *"Invalid dihedral_style"*, then see [this page](https://lammps.sandia.gov/doc/Build_package.html) for instructions to compile LAMMPS to support this package.


### Improper angles

The style of improper interaction used by AMBER force fields depends on an angle which depends on the order of the atoms surrounding the central atom.  When multiple atoms have the same type, this creates ambiguity in atom order.  Since there is no guarantee that moltemplate will choose the same atom order as other molecule builders (such as AmberTools), this can lead to small unavoidable discrepancies in energies and forces computed by LAMMPS and AMBER.  But their effect should be neglegible.

### Bloated lammps input scripts

By default, LAMMPS input scripts prepared using moltemplate contain the entire contents of the GAFF or GAFF2 force-field, even when simulating small systems with just a few atom types.

This is harmless, but if you want to get rid of this extra information, follow the instructions in the "README_remove_irrelevant_info.sh" files.
